/*
 * Copyright 2021-2023 NXP
 *
 * SPDX-License-Identifier: BSD-3-Clause
 */
#ifndef _S32_PINCTRL_H_
#define _S32_PINCTRL_H_

#include <lib/mmio.h>
#include "platform_def.h"

#define SIUL2_MIDR1			(SIUL2_0_BASE_ADDR + 0x00000004)
#define SIUL2_MIDR2			(SIUL2_0_BASE_ADDR + 0x00000008)
#define SIUL2_0_MSCR_BASE	(SIUL2_0_BASE_ADDR + 0x00000240)
#define SIUL2_0_IMCR_BASE	(SIUL2_0_BASE_ADDR + 0x00000A40)
/* redefine these for PLAT_s32r if SIUL2_1 is needed*/
#define SIUL2_1_MSCR_BASE	(SIUL2_1_BASE_ADDR + 0x00000400)
#define SIUL2_1_IMCR_BASE	(SIUL2_1_BASE_ADDR + 0x00000C1C)

/* MSCR 0-101 */
#define SIUL2_0_MSCRn(i)	(SIUL2_0_MSCR_BASE + 4 * (i))
/* MSCR 112-190 */
#define SIUL2_1_MSCRn(i)	(SIUL2_1_MSCR_BASE + 4 * (i - 112))
/* IMCR 0-83 */
#define SIUL2_0_IMCRn(i)	(SIUL2_0_IMCR_BASE +  4 * (i))
/* IMCR 119-495 */
#define SIUL2_1_IMCRn(i)	(SIUL2_1_IMCR_BASE +  4 * (i - 119))

#define SIUL2_MSCR_S32_G1_ODE_EN		BIT(20)
#define SIUL2_MSCR_S32_G1_OBE_EN		BIT(21)
#define SIUL2_MSCR_S32_G1_IBE_EN		BIT(19)
#define SIUL2_MSCR_S32_G1_PUE_EN		BIT(13)
#define SIUL2_MSCR_S32_G1_PUS_EN		BIT(12)
#define SIUL2_MSCR_S32_G1_SMC_DIS		BIT(5)
#define SIUL2_MSCR_MUX_MODE_ALT0		(0x0)
#define SIUL2_MSCR_MUX_MODE_ALT1		(0x1)
#define SIUL2_MSCR_MUX_MODE_ALT2		(0x2)
#define SIUL2_MSCR_MUX_MODE_ALT3		(0x3)
#define SIUL2_MSCR_MUX_MODE_ALT4		(0x4)
#define SIUL2_MSCR_MUX_MODE_ALT5		(0x5)

/*
 * Pinctrl for LinFlexD-UART
 */
#define SIUL2_MSCR_S32_G1_SRC_133MHz	(6 << 14)

#define SIUL2_MSCR_S32G_G1_PORT_CTRL_UART0_TXD	\
	(SIUL2_MSCR_S32_G1_SRC_133MHz |		\
	 SIUL2_MSCR_S32_G1_OBE_EN |		\
	 SIUL2_MSCR_MUX_MODE_ALT1)

#define SIUL2_MSCR_S32G_G1_PORT_CTRL_UART_RXD	\
	(SIUL2_MSCR_S32_G1_SRC_133MHz |		\
	 SIUL2_MSCR_S32_G1_IBE_EN |		\
	 SIUL2_MSCR_MUX_MODE_ALT0)

#define SIUL2_IMCR_S32G_G1_UART0_RXD_to_pad	\
	(SIUL2_MSCR_MUX_MODE_ALT2)

#define SIUL2_MSCR_S32G_G1_PORT_CTRL_UART1_TXD	 \
	(SIUL2_MSCR_S32_G1_SRC_133MHz |		 \
	 SIUL2_MSCR_S32_G1_OBE_EN |		 \
	 SIUL2_MSCR_MUX_MODE_ALT1)

#define SIUL2_IMCR_S32G_G1_UART1_RXD_to_pad	(SIUL2_MSCR_MUX_MODE_ALT3)

/* LinFLEX 0 */
#define SIUL2_PC09_MSCR_S32_G1_UART0		41
#define SIUL2_PC10_MSCR_S32_G1_UART0		42
#define SIUL2_PC10_IMCR_S32_G1_UART0		(512 - 512)

/* LinFLEX 1 */
#define SIUL2_PB09_MSCR_S32_G1_UART1		25
#define SIUL2_PB10_MSCR_S32_G1_UART1		26
#define SIUL2_PB10_IMCR_S32_G1_UART1		(736 - 512)

/*
 * Pinctrl for SDHC S32GEN1
 */
#define SIUL2_MSCR_S32_G1_SRC_150MHz		(5 << 14)

#define SIUL2_USDHC_S32_G1_PAD_CTRL_BASE \
	(SIUL2_MSCR_S32_G1_SRC_150MHz | \
	 SIUL2_MSCR_S32_G1_OBE_EN | \
	 SIUL2_MSCR_S32_G1_IBE_EN | \
	 SIUL2_MSCR_S32_G1_PUE_EN | \
	 SIUL2_MSCR_S32_G1_SMC_DIS)
#define SIUL2_USDHC_S32_G1_PAD_CTRL_CLK \
	(SIUL2_USDHC_S32_G1_PAD_CTRL_BASE | \
	 SIUL2_MSCR_MUX_MODE_ALT1)
#define SIUL2_USDHC_S32_G1_PAD_CTRL_CMD \
	(SIUL2_USDHC_S32_G1_PAD_CTRL_BASE | \
	 SIUL2_MSCR_S32_G1_PUS_EN | \
	 SIUL2_MSCR_MUX_MODE_ALT1)
#define SIUL2_USDHC_S32_G1_PAD_CTRL_DATA \
	(SIUL2_USDHC_S32_G1_PAD_CTRL_BASE | \
	 SIUL2_MSCR_S32_G1_PUS_EN | \
	 SIUL2_MSCR_MUX_MODE_ALT1)
#define SIUL2_USDHC_S32_G1_PAD_RST \
	(SIUL2_MSCR_S32_G1_SRC_150MHz | \
	 SIUL2_MSCR_S32_G1_OBE_EN | \
	 SIUL2_MSCR_S32_G1_PUE_EN | \
	 SIUL2_MSCR_S32_G1_SMC_DIS | \
	 SIUL2_MSCR_MUX_MODE_ALT1)

/* SIUL2_MIDR2 masks */
#define SIUL2_MIDR2_FREQ_SHIFT		(16)
#define SIUL2_MIDR2_FREQ_MASK		(0xF << SIUL2_MIDR2_FREQ_SHIFT)

static inline uint32_t get_siul2_midr2_freq(void)
{
	return ((mmio_read_32(SIUL2_MIDR2) & SIUL2_MIDR2_FREQ_MASK)
			>> SIUL2_MIDR2_FREQ_SHIFT);
}

void s32_plat_config_pinctrl(void);

#endif /* _S32_PINCTRL_H_ */

